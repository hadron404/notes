# Chapter1 可靠、可扩展与可维护的应用系统

## 内容小结
一个应用必须完成预期的多种需求，主要包括**功能性需求**（即*应该做什么*）和一些**非功能性需求**（即*常规特性*）。本章着重讨论了可靠性、可扩展性和可维护性。
**功能性需求** 各种存储、检索、搜索和处理数据
**非功能性需求** 安全性、可靠性、合规性、可伸缩性、兼容性和可维护性


****


## 专业术语
| 术语名称                       | 译文           | 解释                                                           |
| ------------------------------ | -------------- | -------------------------------------------------------------- |
| Data-intensive                 | 数据密集型     |                                                                |
| Compute-intensive              | 计算密集型     |                                                                |
| Data Systems                   | 数据系统       |                                                                |
| Faults                         | 错误/故障      | 可能的出错的事情                                               |
| Fault-tolerant                 | 容错           | 系统可应对错误                                                 |
| Resilient                      | 弹性           | 系统可应对错误                                                 |
| Failure                        | 失效           | 系统作为一个整体停止，无法向用户提供所需的服务                 |
| MTTF                           | 平均无故障时间 |                                                                |
| Telemetry                      | 遥测           | 详细而清晰的监控系统（如性能指标、错误率等监控）               |
| Fan-out                        | 扇出           | 来源于电子工程中的术语                                         |
| Throughput                     | 吞吐量         | 每秒可处理的记录条数或者在某指定数据集上运行作业所需要的总时间 |
| Response Time                  | 响应时间       | 客户端从发送请求到接受响应之间的间隔                           |
| Latency                        | 延迟           | 请求花费在处理上的时间                                         |
| Service Time                   | 服务时间       | 处理请求时间                                                   |
| Service Level Object (SLO)     | 服务质量目标   |                                                                |
| Service Level Agreements (SLA) | 服务质量协议   |                                                                |
| Evolvability                   | 可演化性       | 数据系统级的敏捷性                                             |
|                                |                |                                                                |


## 内容摘要

数据密集型应用通常是基于标准模块构建而成，每个模块负责单一的常用功能。应用系统中常见的模块：
* **数据库**：用以存储数据，这样之后应用可以再次访问
* **高速缓存**：缓存那些复杂或操作代价昂贵的结果，以加快下一次访问
* **索引**：用户可以按关键字搜索数据并支持各种过滤
* **流式处理**：持续发送消息至另一个进程，处理采用异步方式
* **批处理**：定期处理大量的累积数据



### 大多数软件系统都极为重要的三个问题

#### 1 可靠性（Reliability）
>当出现意外情况如硬件、软件故障、人为失误等，系统可以继续正常运转：虽然性能可能有所降低，但确保功能正确。**即使发生了某些错误，系统仍可以继续正常工作。**

对于软件，典型的期望：
* 应用程序执行用户所期望的功能
* 可以容忍用户出现错误或者不正确的软件使用方法
* 性能可以应对典型场景、合理负载压力和数据量
* 系统可防止任何未经授权的访问和滥用


##### 影响可以被消除的故障类型
* 硬件故障：随机的，不相关的
* 软件错误：缺陷通常是系统的，更加难以处理的
* 人为失误：总是很难避免时不时会出错

##### 在假定人是不可靠的，如何保证系统的可靠性？一些思考方法：
* 以最小出错的方式来设计系统
* 想办法分离最容易出错的地方、容易引发故障的接口
* 充分的测试：从各单元测试到全系统集成测试以及手动测试
* 当出现人为失误时，提供快速的恢复机制以尽量减少故障影响
* 设置详细而清晰的监控子系统，包括性能指标和错误率等
* 推行管理流程并加以培训



#### 2 可扩展性（Scalability）
>随着规模的增长，例如数据量、流量或复杂性，系统应以合理的方式来匹配这种增长。
>可扩展性是指负载增加时，有效保持系统性能的相关技术策略。
>可扩展性是用来描述系统应对负载增加能力的术语。


##### 如何描述负载?
负载可以用称为负载参数的若干数字来描述，参数的最佳选择取决于系统的体系结构，有可能是
Web服务器的每秒请求处理次数，数据库中写入的比例，聊天室的同时活动用户数量、缓存命中率等，有时平均值很重要，有时系统瓶颈来自于少数峰值。


##### 如何描述性能?

负载增加，将会发生什么？有两种考虑思路：
1.  负载增加，但**系统资源（如CPU、内存、网络带宽等）保持不变**，系统性能会发生什么变化？
2. 负载增加，如果要**保持性能不变，需要增加多少资源**？


```Note
latency 和 response time 的区别

响应时间是客户端看到的，除了处理请求时间（服务时间）外，还包括来回网络延迟和各种排队延迟
延迟则是请求花费在处理上的时间
```

#### 3 可维护性（Maintainability)
>随着时间的推移，许多新的人员参与到系统开发和运维，以维护现有功能或适配新场景等，系统都应高效运转。
 **可维护性本质上是为了让工程和运营团队更为轻松。
>良好的抽象可以降低复杂性，并使系统更易于修改和适配新场景。
>良好的可操作性意味着对系统健康状况有良好的可观测性和有效的管理方法。**


##### 软件系统的三个设计原则
* **可运维性**：方便运营团队来保持系统平稳运行
* **简单性**：简化系统复杂性，使新工程师能够轻松理解系统。注意，这与用户界面的简单性并不一样
* **可演化性**：后续工程师能够轻松地对系统进行改造，并根据需求变化将其适配到非典型场景，也可称为可延伸性、易修改性或可塑性

###### 可运维性：运维更轻松

一个优秀的运营团队通常至少负责以下内容：
* 监视系统的健康状况，并在服务出现异常状态时快速恢复服务
* 追踪问题的原因，例如系统故障或性能下降
* 保持软件和平台至最新状态，例如安全补丁方面
* 了解不同系统如何相互影响，避免执行带有破坏性的操作
* 预测未来可能的问题，并在问题发生之前及时解决（例如容量规划）
* 建立用于部署、配置管理等良好的实践规范和工具包
* 执行复杂的维护任务，例如将应用系统从一个平台迁移到另一个平台
* 当配置更改时，维护系统的安全稳健
* 制定流程来规范操作行为，并保持生产环境稳定
* 保持相关知识的传承（如对系统理解），例如发生团队人员离职或者新员工加入等


数据系统设计如何在可操作性方面帮助运营团队
* 提供对系统运行时行为和内部的可观测性，方便监控
* 支持自动化，与标准工具集成
* 避免绑定特定的机器，这样在整个系统不间断运行的同时，允许机器停机维护
* 提供良好的文档和易于理解的操作模式
* 提供良好的默认配置，且允许管理员在需要时方便地修改默认值
* 尝试自我修复，在需要时让管理员手动控制系统状态
* 行为可预测，减少意外发生


###### 简单性：简化复杂度
简化系统设计并不意味着减少系统功能，而主要意味着消除意外方面的复杂性。
消除意外复杂性最好手段之一是抽下给你。一个好的设计抽象可以隐藏大量的实现细节，并对外提供干净、易懂的接口。


###### 可演化性：易于改变
一成不变的系统需求几乎没有，想法和目标经常在不断变化：适应新的外部环境，新的用例，业务优先级的变化，用户要求的新功能，新平台取代旧平台，法律或监管要求的变化，业务增长促使架构的演变等。

目标是可以轻松地修改数据系统，使其适应不断变化的需求，这和简单性与抽象性密切相关：简单易懂的系统往往比复杂的系统更容易修改。


