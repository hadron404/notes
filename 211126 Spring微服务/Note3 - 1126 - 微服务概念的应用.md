> 微服务是开发可扩展的原生云系统的利器，但成功的微服务需要细致的设计以避免产生灾难性的后果
>
> 
>
> 微服务也绝非“万金油”，适用于所有的架构场景
>
> 
>
> 一般来说，对于u开发一个轻量级的、模块化的、可扩展的分布式系统而言，微服务会是一个很好的选择
>
> 想要开发一个成功的微服务，选择正确的用例是至关重要的，通过进行适当的权衡分析来采取正确的手机决策也是非常重要的

## 设计微服务需要考虑哪些因素？

* 确定合适的微服务边界： 通过[DDD](http：//domainlanguage.com/ddd/)定义的Bounded Context
* 设计通信方式
  - 同步通信方式
  - 异步通信方式
* 微服务的编制
  * 编制
  * 编排
* 在微服务中有多少端点
* 一台虚拟机部署一个还是多个微服务
  * 虚拟机在高峰期是否有足够的容量同时运行这些服务
  * 是否想要区别对待这些服务以实现SLAs（选择性缩放）
  * 有没有存在冲突的需求
* 规则引擎——共享还是嵌入
* BPM的角色和工作流程
* 微服务能否共享数据存储
  * 设置事务边界
  * 改变用例以简化事务需求
  * 分布式事务场景
* 服务端点设计
  * 协议设计
  * 协议选择
    * 面向消息的服务
    * HTTP和REST端点
    * 优化通信协议
* API文档
* 处理共享库
* 微服务中的用户接口
* 在微服务中使用API网关
* 在微服务中使用ESB和iPaaS
* 服务版本控制的考虑
* 跨域设计
* 处理共享的参考数据
* 微服务和块操作



> 一个bounded context是一个负责执行特定功能的大的领域，或者系统的子领域或子系统
>
> 一个bounded context是确定微服务边界的有效方式

### 有助于定义微服务边界的场景？

> 设计微服务边界最实用的方法是通过一系列可能的选项来把手边的工作运行起来，就像是一个服务的“试金石”

1. 自治功能

2. 可部署单元的大小

3. 最合适的功能或者子域

4. 多语言结构

5. 选择性缩放

6. 小而灵活的团队

7. 单一职责

8. 可复制性或变性

9. 耦合和内聚

10. 把微服务看作一个产品

    

## 微服务使用中的一些挑战

1. 数据孤岛
2. 日志和监控
3. 依赖管理
   * 通过合理地设计服务边界减少依赖
   * 通过设计依赖时尽量低地耦合来减少影响。同样通过异步通信风格设计服务交互
   * 使用类似断路器的设计模式来解决依赖问题
   * 使用可视化依赖图监控依赖
4. 组织文化
5. 管理面临的挑战：分散治理模式
6. 操作费用
7. 测试微服务
8. 基础设施配置



## `⭐微服务能力模型`

![](C:\Users\Administrator\Desktop\211126 Spring微服务\images\微服务的能力模型.png)

* 核心能力：微服务自身的一部分
* 基础设施能力：实现一个成功的微服务在基础设施级别的需求
* 支持能力：软件解决方案支持核心微服务的实现
* 流程和管理能力：关于流程、人员以及参考信息

### 核心能力

* 服务监听者(HTTP/消息传递)
* 存储能力：存储与业务能力相关的状态或者事务性数据
* 业务能力定义：微服务的核心，业务逻辑实现的地方
* 事件源：微服务向外部发送状态改变信息
* 服务端点和通信协议：定义了提供给外部消费者进行消费的API
* API网关
* 用户界面

### 基础设施能力

* 云：一个云相关的基础设施更适合用来部署微服务
* 容器或者虚拟机：提供物理资源的最佳利用，资源隔离，减少管理大型物理基础设备组件的成本
  * VMWare
  * Docker
* 集群控制和配置：在容器的顶层提供了统一的操作环境，并且在多个服务之间共享可用的能力
  * Apache Mesos
  * Kurbernetes
* 应用声明周期管理：有助于一个新的容器启动时唤醒应用或者在容器关闭时关闭应用

### 支持能力

* 软件定义的负载均衡器：足够智能以便能够理解部署拓扑并且做出对应的响应
  * Ribbon、Eureka和Zuul配合使用
* 中央日志管理：提供把所有服务实例产生的日志附上相应ID集中收集的能力
* 服务注册：提供一个运行时环境，一遍服务在运行时能够自动告知外部它们已经可供使用
  * Spring Cloud Eureka
  * Zookeeper
  * Etcd
* 安全服务：一个分布式微服务生态系统需要一个中央服务器来管理服务的安全
  * Spring Security
  * Spring Security OAuth
* 服务配置：需要体现十二因素应用原则置中
  * Spring Cloud Config
  * Archaius
* 测试工具
* 监控和仪表盘：基础设施级别以及服务级别的监控机制
  * 端到端监控工具
    * AppDynamic
    * New Relic
    * Dynatrace
    * statd
    * Sensu
    * Spigo
  * 服务级别
    * Spring Cloud Netflix Turbine
    * Hysterix Dashboard
* 依赖和CI管理：发现运行时拓扑、服务依赖及管理配置项
  * 基于图的CMDB
* 数据池：把不同服务之间存储的数据联系起来，并且进行实时分析
  * 消费数据
    * Spring Cloud Data Flow
    * Flume
    * Kafka
  * 存储数据
    * HDFS
    * Cassandra
* 可靠的消息传递：异步通信方式下，需要一个可靠的消息传递基础设施服务
  * RabbitMQ

### 流程管理能力

* DevOps
* DevOps工具
* 微服务仓库
* 微服务文档
* 参考体系结构和库