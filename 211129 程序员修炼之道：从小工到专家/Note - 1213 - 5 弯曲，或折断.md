# Bend，Or Break

## 解耦与得墨忒耳法则

> 说明怎样让分离的概念保持分离，并降低耦合程度。




> 好篱笆促成好邻居。
>
> ​						————罗伯特·弗罗斯特《补墙》



​	编写“羞怯”的代码使有益的。但“羞怯”的工作方式有两种：**不向别人暴露你自己，不与太多人打交道**。

### Cell(最小组织单位)

​	每个最小组织单位内部的人员可能相互认识，但他们却不认识其他最小组织单位的人，如果某个最小组织单位被发现了，再多的麻醉药也无法使该最小组织单位外部的人的姓名泄露。**切断最小组织单位之间的交往能保护每一个人**



### 函数的德墨忒耳法则[LH89]、[URL56]



遵守德墨忒耳法则有助于创建可维护性更好的代码吗？

​	一些研究表明，在C++中，与具有较小响应集（response set）的类相比，具有较大响应集的类跟容易出错（响应集的定义是：类的各个方法直接调用的函数的数目）

Large-Scale C++ Software Design[Lak96]

## 元程序设计



> 保持灵活的一种好办法是少些代码
>
> 解释怎样把各种细节完全移出代码，那样就可以更安全、更容易地改动它们



> 再多的天才也无法胜过对细节的专注————Levy's Eighth Law



### 动态配置

#### 元数据（metadata）

​	严格地说，元数据是关于数据的数据。

元数据是任何对应用进行描述地数据————应用该怎样运行、它应该使用什么资源，等等。

##### 元数据可以干什么？

* 描述应用的配置选项：调谐参数、用户偏好（user preference）、安装目录

##### 元数据驱动的应用

> 我们想要尽可能多地通过元数据配置和驱动应用。
>
> 我们的目标是以**声明方式思考（规定要做什么，而不是怎么做）**，并创建高度灵活和可适应的程序。



Put Abstractions in Code,Details in Metadata 的好处？

* 迫使你解除你的设计的耦合，从而带来更灵活、可适应性更好的程序
* 迫使你通过推迟细节处理，创建更健壮、更抽象的设计 ——完全推迟到程序之外
* 无需重新编译应用，你就可以对其进行定制
* 与通用的编程语言的情况相比，可以通过一种大为接近问题领域的方式表示元数据
* 可以用相同的应用引擎——但是用不同的元数据——实现若干不同的项目

## 时间耦合（temporal coupling）

> 了解时间与耦合相关的两个方面

​	时间是软件架构的一个常常被忽视的方面。吸引我们的时间只是进度表上的时间，发布之前我们剩余的时间————但这不是我们这里在谈论的时间。相反，我们谈论的是，作为软件自身的一种设计要素的时间的角色。时间有两个方面我们和重要：并发（事情在同一时间发生）和次序（事情在时间中的相对位置）



### 工作流

​	我们想要找出在同一时间可能发生什么，以及什么必须以严格的次序发生。要做的这一点，一种途径是使用像UML活动图（UML activity diagram）这样的表示法来捕捉他们对工作流的描述。



Tip39 Analyze Workflow to Improve Concurrency



### 架构

OLTP： 在线事务处理

#### Tip40 Design Using Services

​	服务 ———— 位于定义良好的、一致的接口之后的独立、并发的对象



#### Tip41 Always Design for Concurrency 

##### 为并发进行设计

> 编写线性代码，我们很容易做出一些假定，把我们引向不整洁的编程。
>
> 但并发迫使你更仔细地对事情进行思考————这不是你一个人的舞会。
>
> 因为事情现在可能会在“同一时间”发生，你可能会秃燃看到某些基于时间的依赖关系。

##### 更整洁的接口	

> 对并发和时序依赖进行思考还能够引导你设计更整洁的接口。





## 它只是视图

> 那人依然只听到，
> 他想要听到的东西，
> 而不顾其他。
> 啦—啦—啦—
> ——Simon and Garfunkel,"The Boxer"



一旦基于责任把程序划分成不同模块，你就有了新的问题。

* 在运行时，对象怎样相互交谈
* 你怎样管理它们之间的逻辑依赖？也就是说，你怎样对这些不同对象中的状态的变化（或数据值的更新）进行同步

### 发布/订阅协议

![](C:\Users\Administrator\Desktop\211129 程序员修炼之道：从小工到专家\images\发布-订阅协议.png)

> 我们可以使用这种发布/订阅机制实现一种非常重要的设计概念：模型与模型的视图的分离

### Tips42 Separate Views from Models



## 黑板

> 提供一个“聚会地点”，各模块可以在那里匿名和异步地交换数据。 这项技术可用于更进一步解除模块的耦合



黑板方法的一些关键特性

​	没有侦探需要知道其他任何侦探的存在————他们查看黑板，从中了解新的信息，并且加上他们的发现。



> 黑板系统让我们解除了我们对象之间的耦合，并提供了一个“论坛”，知识消费者和生产者可以在那里匿名、异步地交换数据。如你可能会猜想的那样，它还减少了我们必须编写的代码的数量

